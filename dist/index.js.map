{"version":3,"file":"index.js","sources":["../node_modules/tslib/tslib.es6.js","../src/dom-fns.ts","../src/music-fns.ts","../src/iter.ts","../src/array-fns.ts","../src/helper-fns.ts","../src/index.ts","../src/init-get-user-media.ts","../src/math-fns.ts"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from) {\r\n    for (var i = 0, il = from.length, j = to.length; i < il; i++, j++)\r\n        to[j] = from[i];\r\n    return to;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","export const toggleClass = (element: HTMLElement, ...cls: string[]) => {\n  element.classList.remove(...cls);\n\n  // Force layout reflow\n  void element.offsetWidth;\n\n  element.classList.add(...cls);\n};\n","export type NoteString = 'C' | 'C#' | 'D' | 'D#' | 'E' | 'F' | 'F#' | 'G' | 'G#' | 'A' | 'A#' | 'B';\nexport type Octave = 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8;\n\nexport const middleA = 440;\n\nexport const SEMI_TONE = 69;\nexport const NOTE_STRINGS: NoteString[] = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\n\nexport interface Note {\n  value: number,\n  index: number,\n  name: NoteString\n  cents: number\n  octave: Octave,\n  frequency: number,\n}\n\nexport function getNote(frequency: number): Note {\n  const noteIndex = getNoteIndex(frequency);\n  // console.log(`${NOTE_STRINGS[noteIndex % 12]}_${Math.floor(noteIndex / 12) - 1}`, noteIndex)\n  return {\n    value: noteIndex % 12,\n    index: noteIndex,\n    name: NOTE_STRINGS[noteIndex % 12],\n    cents: getCents(frequency, noteIndex),\n    octave: Math.floor(noteIndex / 12) - 1 as Octave,\n    frequency: frequency,\n  };\n}\n\n/**\n * Get musical note from frequency\n */\nexport function getNoteIndex(frequency: number) {\n  const note = 12 * (Math.log(frequency / middleA) / Math.log(2))\n  return Math.round(note) + SEMI_TONE\n}\n\n/**\n * Get the musical note's standard frequency\n */\nexport function getStandardFrequency(note: number) {\n  return middleA * (2 ** ((note - SEMI_TONE) / 12));\n}\n\n/**\n * Get cents difference between given frequency and musical note's standard frequency\n */\nexport function getCents(frequency: number, note: number) {\n  return Math.floor((1200 * Math.log(frequency / getStandardFrequency(note))) / Math.log(2));\n}\n\nexport function volumeAudioProcess(buf: Float32Array) {\n  let bufLength = buf.length;\n  let sum = 0;\n  let x;\n\n  // Do a root-mean-square on the samples: sum up the squares...\n  for (let i = 0; i < bufLength; i++) {\n    x = buf[i];\n    sum += x * x;\n  }\n\n  // ... then take the square root of the sum.\n  let rms = Math.sqrt(sum / bufLength);\n\n  return rms;\n}\n\n","/** Allows an iterator to be used within a for loop to continue the iteration */\nexport function cont<T>(it: Iterator<T>) {\n  return { [Symbol.iterator]() { return it } }\n}\n\nexport function* groupedUntilChanged<X>(xs: Iterable<X>, equals: (a: X, b: X) => boolean = (a, b) => a === b): IterableIterator<X[]> {\n  const it = xs[Symbol.iterator]();\n  const { done, value: initial } = it.next();\n  if (done) return;\n\n  let group: X[] = [initial];\n  let prev = initial;\n\n  for (const x of cont(it)) {\n    if (equals(x, prev)) {\n      group.push(x);\n    } else {\n      yield group;\n      group = [x];\n    }\n    prev = x;\n  }\n\n  yield group\n}\n\nexport function first<X>(xs: Iterable<X>) {\n  for (const x of xs) return x;\n}","export const range = (from: number, to: number) => [...Array(to - from + 1).keys()].map(x => x + from);\nexport const rangeX = (from: number, to: number) => [...Array(to - from).keys()].map(x => x + from);\n\nexport const flat = <X>(xs: X[][]) => (<X[]>[]).concat(...xs)\n\nexport const queue = <T>(a: T[] | null | undefined, x: T) => \n  (a?.pop(), a?.unshift(x), a);\n\nexport const closest = (a: number[], goal: number) => \n  a.reduce((prev, curr) => (Math.abs(curr - goal) < Math.abs(prev - goal) ? curr : prev));\n\nexport const closestBy = <X>(xs: X[], goal: X, distFn: (a: X, b: X) => number) => \n  xs.reduce((prev, curr) => (distFn(curr, goal) < distFn(prev, goal) ? curr : prev));","export const set = (obj: any, prop: any, value: any) => obj && (obj[prop] = value);\nexport const isTruthy = (x: any) => !!x;\nexport const isFalsey = (x: any) => !x;\nexport const throwError = (m?: string) => { throw Error(m) };\n\nexport function once<T extends Element, K extends keyof ElementEventMap>(el: T, ev: K): Promise<ElementEventMap[K]>;\nexport function once<T extends ScriptProcessorNode, K extends keyof ScriptProcessorNodeEventMap>(el: T, ev: K): Promise<ScriptProcessorNodeEventMap[K]>;\nexport function once<T extends EventTarget>(el: T, ev: string): Promise<Event>;\nexport function once<T extends EventTarget>(el: T, ev: string) { \n  return new Promise(r => el.addEventListener(ev, r, { once: true }));\n}\n\nexport const timeout = (t: number) => new Promise(r => setTimeout(r, t));\n\nexport const debounce = (delay: number, fn: (...args: any[]) => any) => {\n  let timer: number;\n  return (...args: any[]) => {\n    clearTimeout(timer);\n    timer = setTimeout(() => fn(...args), delay);\n  };\n};\n\nexport const throttle = (limit: number, fn: (...args: any[]) => any) => {\n  let wait = false;\n  const dyn: { last: any[] | null } = { last: null };\n  return (...args: any[]) => {\n    dyn.last = args;\n    if (!wait) {\n      fn(...args);\n      wait = true;\n      setTimeout(() => { \n        wait = false;\n        fn(...<any[]>dyn.last);\n      }, limit);\n    }\n  }\n};","/**\n * Copyright (C) 2021 Online Mic Test\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as published\n * by the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program.  If not, see <https://www.gnu.org/licenses/>.\n * @license\n */\n\nimport { initGetUserMedia } from \"./init-get-user-media\";\nimport { toggleClass } from \"./dom-fns\";\nimport { getNote, NoteString, Octave } from \"./music-fns\";\nimport { groupedUntilChanged } from \"./iter\";\nimport { closest, closestBy, flat, queue, range } from \"./array-fns\";\nimport { isTruthy, once, set, throttle, throwError, timeout } from \"./helper-fns\";\nimport { clamp, round } from \"./math-fns\";\n\nconsole.log('Licensed under AGPL-3.0: https://github.com/onlinemictest/guitar-tuner')\n\nconst BUFFER_SIZE = 8192;\nconst INTERVAL_TIME = 185; // ms\n\n// Note buffer sizes\nconst NOTE_BUFFER_SIZE = 15; \nconst TUNE_BUFFER_SIZE = 4;\n\nconst NOTE_STRINGS: NoteString[] = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\nconst OCTAVES: Octave[] = [1, 2, 3, 4, 5, 6, 7, 8];\nconst NOTES = flat(OCTAVES.map(o => NOTE_STRINGS.map(n => `${n}_${o}`)));\n\nconst GUITAR_FREQ = {\n  'E_4': 329.63,\n  'B_3': 246.94,\n  'G_3': 196.00,\n  'D_3': 146.83,\n  'A_2': 110.00,\n  'E_2': 82.41,\n};\ntype GuitarNoteName = keyof typeof GUITAR_FREQ;\nconst GUITAR_NOTES = Object.keys(GUITAR_FREQ) as GuitarNoteName[];\n// const GUITAR_FREQ_INV = new Map(Object.entries(GUITAR_FREQ).map(([a, b]) => [b, a])) as Map<number, GuitarNoteName>\n// const GUITAR_FREQ_VAL = Object.values(GUITAR_FREQ).sort();\n\nconst ANIM_DURATION = 500;\n\nconst translate = {\n  X: 'translateX',\n  Y: 'translateY',\n};\n\n// const getClosestGuitarNoteByFreq = (f: number) => GUITAR_FREQ_INV.get(closest(GUITAR_FREQ_VAL, f)) ?? throwError();\nconst getClosestGuitarNote = (n: `${NoteString}_${Octave}`) => \n  closestBy(GUITAR_NOTES, n, (a, b) => Math.abs(NOTES.indexOf(a) - NOTES.indexOf(b))) as GuitarNoteName;\n\ninitGetUserMedia();\n\nif (false\n  || !('WebAssembly' in window) \n  || !('AudioContext' in window) \n  || !('createAnalyser' in AudioContext.prototype) \n  || !('createScriptProcessor' in AudioContext.prototype) \n) {\n  if (!('WebAssembly' in window)) throw alert(`Browser not supported: 'WebAssembly' is not defined`);\n  if (!('AudioContext' in window)) throw alert(`Browser not supported: 'AudioContext' is not defined`)\n  if (!('createAnalyser' in AudioContext.prototype)) throw alert(`Browser not supported: 'AudioContext.prototype.createAnalyser' is not defined`)\n  if (!('createScriptProcessor' in AudioContext.prototype)) throw alert(`Browser not supported: 'AudioContext.prototype.createScriptProcessor' is not defined`)\n}\n\n// @ts-expect-error\nAubio().then(({ Pitch }) => {\n  const guitarTuner = document.getElementById('guitar-tuner') as HTMLDivElement | null;\n  const startEl = document.getElementById('audio-start') as HTMLButtonElement | null;\n  const pauseEl = document.getElementById('audio-pause') as HTMLButtonElement | null;\n  const tuneUpText = document.getElementById('tune-up-text') as HTMLDivElement | null;\n  const tuneDownText = document.getElementById('tune-down-text') as HTMLDivElement | null;\n  const pressPlay = document.getElementById('circle-text-play') as HTMLSpanElement | null\n  const pluckAString = document.getElementById('circle-text-pluck') as HTMLSpanElement | null;\n  const errorEl = document.getElementById('circle-text-error') as HTMLSpanElement | null;\n  const noteSpan = document.getElementById('circle-note') as HTMLSpanElement | null;\n  const matchCircleL = document.getElementById('match-circle-l') as HTMLDivElement | null;\n  const matchCircleR = document.getElementById('match-circle-r') as HTMLDivElement | null;\n  const innerCircle = document.getElementById('inner-circle') as HTMLDivElement | null;\n\n  const tunedJingle = document.getElementById('tuned-jingle') as HTMLAudioElement;\n  tunedJingle.volume = 0.01;\n  const JINGLE_VOLUME = 0.5; // set after initial play to get around Safari limitation\n\n  const noteEls = new Map(Object.entries(GUITAR_FREQ).map(([n]) => [n, document.getElementById(n) as unknown as SVGGElement]));\n  const fillEls = new Map(Object.entries(GUITAR_FREQ).map(([n]) => [n, document.getElementById(`${n}-fill`) as unknown as SVGGElement]));\n\n  if (false\n    || !guitarTuner\n    || !startEl\n    || !pauseEl\n    || !tuneUpText\n    || !tuneDownText\n    || !pressPlay\n    || !pluckAString\n    || !errorEl\n    || !noteSpan\n    || !matchCircleL\n    || !matchCircleR\n    || !innerCircle\n    || !tunedJingle\n    || ![...noteEls.values()].every(isTruthy)\n    || ![...fillEls.values()].every(isTruthy)\n  ) {\n    return alert('Expected HTML element missing');\n  }\n\n  const updateTuneText = throttle(500, (isClose: boolean, isTooLow: boolean) => {\n    if (isClose) {\n      tuneUpText.classList.remove('show');\n      tuneDownText.classList.remove('show');\n    } else {\n      tuneUpText.classList[isTooLow ? 'add' : 'remove']('show');\n      tuneDownText.classList[isTooLow ? 'remove' : 'add']('show');\n    }\n  });\n\n  let audioContext: AudioContext;\n  let analyser: AnalyserNode;\n  let scriptProcessor: ScriptProcessorNode;\n  let pitchDetector: Aubio.Pitch;\n  let stream: MediaStream;\n  let intervalId: number;\n\n  matchCircleL.style.transform = `${translate.Y}(125%)`;\n\n  const pauseCallback = () => {\n    startEl.style.display = 'block';\n    pauseEl.style.display = 'none';\n    pressPlay.style.opacity = '1';\n    pluckAString.style.opacity = '0';\n    noteSpan.style.opacity = '0';\n    noteSpan.style.color = '';\n    matchCircleL.style.transform = `${translate.Y}(125%)`;\n    tuneUpText.classList.remove('show');\n    tuneDownText.classList.remove('show');\n    updateTuneText(true);\n    if ('animate' in Element.prototype) \n      startEl.animate([{ transform: 'translateY(10vw) scale(0.33)' }, { transform: 'translateY(0) scale(1)' }], { duration: 125, easing: 'ease' });\n    else\n      toggleClass(startEl, 'blob-animation');\n  };\n\n  pauseEl.addEventListener('click', async () => {\n    clearInterval(intervalId);\n    pauseCallback();\n    await Promise.race([once(startEl, 'animationend'), timeout(250)]);\n\n    scriptProcessor.disconnect(audioContext.destination);\n    analyser.disconnect(scriptProcessor);\n    audioContext.close();\n    stream.getTracks().forEach(track => track.stop());\n  });\n\n  startEl.addEventListener('click', async () => {\n    await tunedJingle.play();\n    await timeout(1000);\n    tunedJingle.volume = JINGLE_VOLUME;\n  }, { once: true });\n\n  startEl.addEventListener('click', async () => {\n    guitarTuner.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    startEl.style.display = 'none';\n    pauseEl.style.display = 'block';\n    if ('animate' in Element.prototype)\n      pauseEl.animate([{ transform: 'translateY(-10vw) scale(3) ' }, { transform: 'translateY(0) scale(1)' }], { duration: 125, easing: 'ease' });\n    else \n      toggleClass(pauseEl, 'shrink-animation');\n\n    await Promise.race([once(pauseEl, 'animationend'), timeout(250)]);\n\n    audioContext = new AudioContext();\n    analyser = audioContext.createAnalyser();\n    scriptProcessor = audioContext.createScriptProcessor(BUFFER_SIZE, 1, 1);\n    pitchDetector = new Pitch('default', BUFFER_SIZE, 1, audioContext.sampleRate);\n    pitchDetector.setSilence(-60);\n\n    try {\n      stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n\n      audioContext.createMediaStreamSource(stream).connect(analyser);\n      analyser.connect(scriptProcessor);\n      scriptProcessor.connect(audioContext.destination);\n\n      pressPlay.style.opacity = '0';\n      errorEl.style.opacity = '0';\n      pluckAString.style.opacity = '1';\n\n      // let prevCents = -50;\n      // let prevNote = '';\n\n      let resetable = false;\n      let softResettable = false;\n      let jinglePlayed = false;\n      let lastNote: string | null = null;\n\n      // const prevNotes: string[] = new Array(PREV_BUFFER_SIZE).fill(undefined);\n      const noteBuffer: (string | undefined)[] = new Array(NOTE_BUFFER_SIZE).fill(undefined);\n\n      let centsBufferMap: Map<GuitarNoteName, number[]> = new Map(GUITAR_NOTES.map(n => [n, []]));\n      let jinglePlayedMap: Map<GuitarNoteName, boolean> = new Map(GUITAR_NOTES.map(n => [n, false]));\n\n      // /** The last 3 notes including undefined. Used to reset the cents buffer between plucks of the string */\n      // const pauseBuffer: string[] = new Array(PREV_BUFFER_SIZE).fill(undefined);\n\n      const initialEvent = await once(scriptProcessor, 'audioprocess');\n      const initialBuffer = initialEvent.inputBuffer.getChannelData(0);\n      const initialFreq = pitchDetector.do(initialBuffer);\n\n      const box: { frequency: number } = { frequency: initialFreq };\n      scriptProcessor.addEventListener('audioprocess', event => {\n        // console.timeEnd('audioprocess');\n        // console.time('audioprocess');\n\n        const buffer = event.inputBuffer.getChannelData(0);\n        // volume = volumeAudioProcess(buffer);\n        box.frequency = pitchDetector.do(buffer);\n      });\n\n      intervalId = setInterval(() => {\n        // console.timeEnd('interval');\n        // console.time('interval');\n\n        const { frequency } = box;\n        const note = getNote(frequency);\n\n        queue(noteBuffer, note.name);\n\n        // If there has been nothing but noise for the last couple of seconds, show the message again:\n        const isNoise = [...groupedUntilChanged(noteBuffer.filter(isTruthy))].every(g => g.length <= 3);\n        const groupedByNote = [...groupedUntilChanged(noteBuffer)][0];\n\n        console.log([...groupedUntilChanged(noteBuffer)].map(ns => ns.map(n => n === undefined ? '-' : n.endsWith('#') ? n.charAt(0).toLocaleLowerCase() : n).join('')).join(''));\n\n        const isSilent = groupedByNote[0] === undefined && groupedByNote.length >= 2; // reset fill-up animation after two consecutive undefined values\n        if (isNoise) {\n          if (resetable) {\n            resetable = false;\n            pressPlay.style.opacity = '0';\n            pluckAString.style.opacity = '1';\n            noteSpan.style.opacity = '0';\n            noteSpan.style.color = '';\n            matchCircleL.style.transform = `${translate.Y}(125%)`;\n            updateTuneText(true);\n          }\n        }\n        else if (note.name && !Number.isNaN(note.cents)) {\n          if (tunedJingle.paused) {\n            resetable = true;\n            softResettable = true;\n\n            const noteName = `${note.name}_${note.octave}` as `${NoteString}_${Octave}` ;\n            // const guitarNoteName = getClosestGuitarNoteByFreq(note.frequency);\n            const guitarNoteName = getClosestGuitarNote(noteName);\n\n            // console.log(note.frequency, noteName, guitarNoteName);\n\n            // if (prevNote == note.name)\n            // const degDiff = Math.trunc(Math.abs(prevDeg - deg));\n            // prevDeg = deg;\n            // const transformTime = (degDiff + 25) * 15;\n            // console.log(noteName, note.cents)\n\n            const foobar = GUITAR_FREQ[guitarNoteName];\n            \n            const isTooLow = frequency < foobar;\n\n            const baseCents = noteName === guitarNoteName\n              ? note.cents\n              : isTooLow ? -50 : 50;\n\n            const absCents100 = Math.abs(baseCents) * 2;\n            const sensitivity = Math.min(10, Math.round(100 / absCents100));\n            const centsUI = round(baseCents, sensitivity);\n\n            const isClose = noteName === guitarNoteName && centsUI === 0;\n            updateTuneText(isClose, isTooLow);\n\n            // console.log(`${absCents2}/100 => %${sensitivity} => ${Math.abs(centsApprox) * 2}/100`);\n            // const centsApprox = note.cents;\n            // console.log(centsApprox)\n\n            // const transitionTime = 200 + Math.abs(prevCents - centsApprox) * 10;\n            // console.log(transitionTime)\n\n            // matchCircleR.style.transform = `translateY(${note.cents}%)`;\n            pluckAString.style.opacity = '0';\n            noteSpan.style.opacity = '1';\n            const gnn = guitarNoteName.split('_')[0];\n            if (lastNote !== gnn) { noteSpan.innerText = gnn }\n            lastNote = gnn;\n\n            const centsBuffer = centsBufferMap.get(guitarNoteName) ?? [];\n            const jinglePlayed = jinglePlayedMap.get(guitarNoteName) ?? false;\n            if (noteName === guitarNoteName && centsUI === 0) centsBuffer.push(0);\n\n            const tuneRatio = clamp(centsBuffer.length / TUNE_BUFFER_SIZE); // skip 1 entry to allow animation to complete\n            // console.log(noteName, tuneRatio)\n            innerCircle.style.transition = `transform ${ANIM_DURATION}ms ease`\n            innerCircle.style.transform = `scale(${1 - tuneRatio})`;\n\n            noteSpan.style.transition = `color ${ANIM_DURATION}ms ease`\n            noteSpan.style.color = tuneRatio === 1 ? '#fbfbfb' : '#fbfbfb88';\n\n            matchCircleL.style.transition = `transform ${ANIM_DURATION}ms ease`;\n            matchCircleL.style.transform = `${translate.Y}(${-centsUI}%)`;\n\n            if (tuneRatio === 1 && !jinglePlayed) {\n              setTimeout(() => (tunedJingle.play(), toggleClass(noteSpan, 'explode')), ANIM_DURATION); // give animation time to finish\n              set(noteEls.get(guitarNoteName)?.querySelector('path')?.style, 'fill', 'rgb(67,111,142)');\n              set(fillEls.get(guitarNoteName)?.style, 'display', 'block');\n              // jinglePlayed = true;\n              jinglePlayedMap.set(guitarNoteName, true)\n            }\n\n            // console.log(`Streak: ${centsHits.length}/${centsBuffer.length}`)\n\n            // prevCents = centsUI;\n            // prevNote = noteName;\n          }\n\n          // queue(prevNotes, note.name);\n        }\n        else if (softResettable && isSilent) {\n          // console.log('soft reset');\n          innerCircle.style.transition = 'transform 100ms'\n          innerCircle.style.transform = `scale(1)`;\n          softResettable = false;\n          jinglePlayed = false;\n          jinglePlayedMap = new Map(GUITAR_NOTES.map(n => [n, false]));\n          centsBufferMap = new Map(GUITAR_NOTES.map(n => [n, []]));\n        }\n\n        // // console.log(pauseBuffer)\n        // queue(pauseBuffer, note.name);\n      }, INTERVAL_TIME);\n    } catch (err) {\n      clearInterval(intervalId);\n      pauseCallback();\n      pressPlay.style.opacity = '0';\n      errorEl.innerText = err.message;\n      errorEl.style.opacity = '1';\n    };\n  });\n});\n","export function initGetUserMedia() {\n  // @ts-ignore\n  window.AudioContext = window.AudioContext || window.webkitAudioContext\n  if (!window.AudioContext) {\n    return alert('AudioContext not supported')\n  }\n\n  // Older browsers might not implement mediaDevices at all, so we set an empty object first\n  if (navigator.mediaDevices === undefined) {\n    // @ts-ignore\n    navigator.mediaDevices = {}\n  }\n\n  // Some browsers partially implement mediaDevices. We can't just assign an object\n  // with getUserMedia as it would overwrite existing properties.\n  // Here, we will just add the getUserMedia property if it's missing.\n  if (navigator.mediaDevices.getUserMedia === undefined) {\n    navigator.mediaDevices.getUserMedia = function (constraints) {\n      // First get ahold of the legacy getUserMedia, if present\n      // @ts-ignore\n      const getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia\n\n      // Some browsers just don't implement it - return a rejected promise with an error\n      // to keep a consistent interface\n      if (!getUserMedia) {\n        alert('getUserMedia is not implemented in this browser')\n      }\n\n      // Otherwise, wrap the call to the old navigator.getUserMedia with a Promise\n      return new Promise(function (resolve, reject) {\n        getUserMedia.call(navigator, constraints, resolve, reject)\n      })\n    }\n  }\n}","export const floor = (n: number, basis = 1) => Math.floor(n / basis) * basis;\nexport const ceil = (n: number, basis = 1) => Math.ceil(n / basis) * basis;\nexport const round = (n: number, basis = 1) => Math.round(n / basis) * basis;\nexport const clamp = (n: number) => Math.max(0, Math.min(1, n));"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","toggleClass","element","cls","classList","remove","offsetWidth","add","NOTE_STRINGS","getNote","frequency","noteIndex","note","Math","log","round","getNoteIndex","index","name","cents","getCents","octave","floor","getStandardFrequency","groupedUntilChanged","xs","equals","a","b","it","Symbol","iterator","initial","group","prev","x","[object Object]","cont","push","set","obj","prop","isTruthy","once","el","ev","r","addEventListener","timeout","t","setTimeout","console","NOTES","map","o","n","concat","GUITAR_FREQ","E_4","B_3","G_3","D_3","A_2","E_2","GUITAR_NOTES","Object","keys","translate","window","AudioContext","webkitAudioContext","alert","undefined","navigator","mediaDevices","getUserMedia","constraints","webkitGetUserMedia","mozGetUserMedia","call","initGetUserMedia","prototype","Aubio","Pitch","guitarTuner","document","getElementById","startEl","pauseEl","tuneUpText","tuneDownText","pressPlay","pluckAString","errorEl","noteSpan","matchCircleL","matchCircleR","innerCircle","tunedJingle","volume","noteEls","Map","entries","fillEls","values","every","updateTuneText","limit","fn","wait","dyn","last","args","throttle","isClose","isTooLow","audioContext","analyser","scriptProcessor","pitchDetector","stream","intervalId","style","transform","pauseCallback","display","opacity","color","Element","animate","duration","easing","clearInterval","race","disconnect","destination","close","getTracks","forEach","track","stop","play","scrollIntoView","behavior","block","createAnalyser","createScriptProcessor","sampleRate","setSilence","audio","createMediaStreamSource","connect","resetable","softResettable","jinglePlayed","lastNote","noteBuffer","Array","fill","centsBufferMap","jinglePlayedMap","initialBuffer","inputBuffer","getChannelData","box","do","event","buffer","setInterval","pop","unshift","isNoise","filter","g","length","groupedByNote","ns","endsWith","charAt","toLocaleLowerCase","join","isSilent","Number","isNaN","paused","noteName","guitarNoteName","goal","distFn","abs","indexOf","reduce","curr","baseCents","absCents100","centsUI","basis","min","gnn","split","innerText","centsBuffer","get","tuneRatio","max","clamp","transition","querySelector","err","message"],"mappings":"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"}